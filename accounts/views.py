from django.shortcuts import render, redirect
from django.contrib.auth import get_user_model, login as auth_login
from django.contrib.auth import logout as auth_logout
from django.views.decorators.http import require_http_methods
from .forms import CustomUserCreationForm
from django.contrib.auth.forms import AuthenticationForm

# Create your views here.
def index(request):
    return render(request, 'accounts/index.html')


@require_http_methods(['GET', 'POST'])
def signup(request):
    if request.method == 'POST':
        form = CustomUserCreationForm(request.POST, request.FILES)
        if form.is_valid():
            # form.save()를 하면 현재 가입된 유저가 반환된다...?!
            user = form.save()
            # user.profile_img = 'data:image/jpeg;base64,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'
            auth_login(request, user, backend='django.contrib.auth.backends.ModelBackend')
            return redirect('homepage:index')
    else:
        form = CustomUserCreationForm()
    context = {
        'form': form,
    }
    return render(request, 'accounts/signup.html', context)


def login(request):
    if request.method == 'POST':
        form = AuthenticationForm(request, request.POST)
        if form.is_valid():
            auth_login(request, form.get_user(), backend='django.contrib.auth.backends.ModelBackend')
            return redirect('homepage:index')
    else:
        form = AuthenticationForm()
    context = {
        'form': form,
    }
    return render(request, 'accounts/login.html', context)


def logout(request):
    auth_logout(request)
    return redirect('accounts:index')
